Here's the cleaned-up **challenge summary** without emojis:

---

### Flash CTF – Christmas Trees (MetaCTF, December 2024)

**Category:** Binary Exploitation
**Difficulty:** Medium–Hard
**Vulnerability:** Stack Buffer Overflow via Miscalculated Tree Size
**Exploit Technique:** Ret2win with Partial Return Address Overwrite
**Mitigations:** Stack canaries, ASLR (bypassed via brute-force)

---

### Challenge Overview

The binary parses input strings representing binary trees (referred to as “Christmas trees”), with each node as a character and child nodes wrapped in parentheses. It serializes the tree into a flat array using heap-like indexing (`left = 2i+1`, `right = 2i+2`).

**Bug:** The program assumes trees are complete and balanced, underestimating buffer size for deeply imbalanced trees, which leads to a stack-based buffer overflow.

---

### Exploitation Strategy

- A deeply nested, sparse tree is used to cause the program to allocate a small buffer.
- Deserialization writes beyond the end of the buffer, allowing an out-of-bounds write on the stack.
- Two crafted characters (`'i'` and `'S'`) are placed to partially overwrite the return address.
- Despite ASLR, only 4 bits of the return address need to be guessed (\~16 tries on average).
- Upon success, control flow is redirected to the hidden `debug_shell()` function, granting shell access.

---

### Exploit Tree Input

```
0()(1()(2()(3(4(()(i))((S)()))())))
```

This tree causes under-allocation and controlled stack corruption during deserialization.

---

### Solve Script Highlights

- Uses `pwntools` to automate repeated attempts.
- Sends the crafted tree and checks for shell access.
- Upon success, runs `uname`, `id`, and `cat flag.txt`.

---

### Flag

```
MetaCTF{0h_chr1stm4s_tr33_h0w_l0v3ly_4r3_y0ur_br4nch3s}
```

---

This challenge demonstrates how logic bugs in tree parsing can lead to serious memory corruption vulnerabilities, with a clever use of partial overwrite and return-to-win exploitation.
