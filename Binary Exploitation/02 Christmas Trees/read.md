Here's the cleaned-up **challenge summary** without emojis:

---

### Flash CTF – Christmas Trees (MetaCTF, December 2024)

**Category:** Binary Exploitation
**Difficulty:** Medium–Hard
**Vulnerability:** Stack Buffer Overflow via Miscalculated Tree Size
**Exploit Technique:** Ret2win with Partial Return Address Overwrite
**Mitigations:** Stack canaries, ASLR (bypassed via brute-force)

---

### Challenge Overview

The binary parses input strings representing binary trees (referred to as “Christmas trees”), with each node as a character and child nodes wrapped in parentheses. It serializes the tree into a flat array using heap-like indexing (`left = 2i+1`, `right = 2i+2`).

**Bug:** The program assumes trees are complete and balanced, underestimating buffer size for deeply imbalanced trees, which leads to a stack-based buffer overflow.

---

### Exploitation Strategy

- A deeply nested, sparse tree is used to cause the program to allocate a small buffer.
- Deserialization writes beyond the end of the buffer, allowing an out-of-bounds write on the stack.
- Two crafted characters (`'i'` and `'S'`) are placed to partially overwrite the return address.
- Despite ASLR, only 4 bits of the return address need to be guessed (\~16 tries on average).
- Upon success, control flow is redirected to the hidden `debug_shell()` function, granting shell access.

---

### Exploit Tree Input

```
0()(1()(2()(3(4(()(i))((S)()))())))
```

This tree causes under-allocation and controlled stack corruption during deserialization.

---

### Solve Script Highlights

- Uses `pwntools` to automate repeated attempts.
- Sends the crafted tree and checks for shell access.
- Upon success, runs `uname`, `id`, and `cat flag.txt`.

---

### Flag

```
MetaCTF{0h_chr1stm4s_tr33_h0w_l0v3ly_4r3_y0ur_br4nch3s}
```

---

This challenge demonstrates how logic bugs in tree parsing can lead to serious memory corruption vulnerabilities, with a clever use of partial overwrite and return-to-win exploitation.

Certainly! Here's the **Vulnerability Summary** section for the _Christmas Trees_ challenge:

---

## Vulnerability Summary

The binary parses strings representing binary trees and stores them in a stack-allocated array. It calculates the required buffer size by counting the number of nodes and assuming the tree is fully balanced. However, this logic fails when the tree is **deep and sparse** (e.g., having only right children), where the **depth exceeds the allocated array size**.

As a result, during deserialization, the program writes **beyond the bounds of the stack buffer**, causing a **stack-based buffer overflow**. Because the stack layout places the return address near the end of the array, carefully crafted input can be used to **partially overwrite the return address**. Although stack canaries are present and **ASLR is enabled**, the attacker leverages:

- **A hidden `debug_shell()` function** (ret2win-style exploitation).
- **Partial return address overwrite** (only lower 2 bytes needed).
- **Brute-force guessing** (\~16 tries on average due to 4 bits of entropy).

This leads to reliable control of execution flow and ultimately a shell, allowing retrieval of the flag.

---

Let me know if you'd like this integrated into a full report or PDF.
